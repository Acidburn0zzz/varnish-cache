varnishtest "Detect probe interval inversion"

barrier bprobe cond 2

server s1 {
	# 5 probe requests
	rxreq
	txresp
	close
	accept
	rxreq
	txresp
	close
	accept
	rxreq
	txresp
	close
	accept
	rxreq
	txresp
	close
	accept
	rxreq
	txresp
	close
	accept
	barrier bprobe sync
} -start

varnish v1 -cliok {param.set vcc_err_unref off}

varnish v1 -vcl {
	backend b1 {
		.host = "${s1_sock}";
		.probe = { .interval = 1s; }
	}

	backend b2 {
		.host = "${bad_backend}";
		.probe = { .interval = 24h; }
	}
} -start

barrier bprobe sync
